<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cherry Blossom DEMO</title>
  <link rel="stylesheet" href="level_anime.css"><!-- CSS読み込み -->
</head>
<body>
  <div class="cherry-blossom-container">
    <img id="hero" style="width: 30%;" src="img/22338667.png" alt="ないよ">
    <progress id="lifeBar" value="0" max="100" min="0" optimum="100"></progress>
    <div>Lv.
      <div id="level">1</div>
    </div>
    <!-- <div id="level"><?php echo $user_data('pre_level') ?></div> -->
    <div id="ohome_word">a</div>
  </div>
</body>

<script>

  // 前回からレベルが上がった分だけ処理を繰り返したい
  // 且つ、経験値も現在の値までアニメーションさせたい
  // 「前回のレベル」はテーブル設計を微修正の必要アリ

  // 課題：
  // 経験値の定義がうまくいかない

  function update() {
    gameTimer = setTimeout(update, 7);
    let heroImg = document.getElementById('hero');
    let lifeBar = document.getElementById('lifeBar');
    let level = document.getElementById('level'); 
    let ohome = document.getElementById('ohome_word'); 
    lifeBar.value++;

      // PHPを使ったSQL処理からユーザーレベルと経験値を持ってくる処理
      
    // let previousLevel = <?php echo $user_data('pre_level') ?>;
    // let currentLevel = <?php echo $user_data('level') ?>;
    // let previousExp = <?php echo $user_data('pre_exp') ?>;
    // let currentExp = <?php echo $user_data('exp') ?>;

    // let exExp = currentExp % 100;
    // let lifeBar.value = exExp;
    // lifeBar.value = 30;
    
    let currentLevel = 4;
    let exExp = 60;
    
    // 経験値が100になったら、レベルが上がる
    if(lifeBar.value >= lifeBar.max){
      lifeBar.value = 0;
      level.innerHTML++;
      // ohome.innnetHTML = "がんばったね";
      
      //規定レベルに達したらループ終了
      if(level.innerHTML >= currentLevel){
        document.getElementById("level").classList.add("");
        lifeBar.value = 0;
        if(lifeBar.value = exExp){
          clearTimeout(gameTimer);

          // コンテナを指定
          const section = document.querySelector('.cherry-blossom-container');
          // 花びらを生成する関数
          const createPetal = () => {
            const petalEl = document.createElement('span');
            petalEl.className = 'petal';
            const minSize = 10;
            const maxSize = 15;
            const size = Math.random() * (maxSize + 1 - minSize) + minSize;
            petalEl.style.width = `${size}px`;
            petalEl.style.height = `${size}px`;
            petalEl.style.left = Math.random() * innerWidth + 'px';
            section.appendChild(petalEl);

            // 一定時間が経てば花びらを消す
            setTimeout(() => {
              petalEl.remove();
            }, 10000);
          }
      // 花びらを生成する間隔をミリ秒で指定
        setInterval(createPetal, 300);
        }
      }
    }    
  }
    
  update();


</script>



